<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dịch cổ ngữ Philíphe Bỉnh</title>

    <style>
        body { 
            font-family: sans-serif; 
            max-width: 800px; 
            margin: 40px auto; 
            line-height: 1.5;
        }
        textarea { width: 100%; height: 120px; margin-top: 10px; }
        button { 
            padding: 10px 18px; 
            margin-right: 10px; 
            margin-top: 15px;
            cursor: pointer; 
        }
        #result-box {
            margin-top: 30px; 
            padding: 15px; 
            border: 1px solid #ddd;
            display: none;
        }
        #error-box {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid red;
            color: red;
            display: none;
        }
    </style>
</head>

<body>

<h2>Dịch sang cổ ngữ Philíphe Bỉnh</h2>

<label>Nhập văn bản tiếng Việt hiện đại:</label>
<textarea id="modern-text" placeholder="VD: Tôi đi chợ mua cá..."></textarea>

<br>

<button onclick="translateFast()">Dịch nhanh (rule-based)</button>
<button onclick="translateSmart()">Dịch AI tinh chỉnh (LLM)</button>

<div id="error-box"></div>

<div id="result-box">
    <h3>Bản dịch:</h3>
    <div id="translation"></div>

    <h3>Giải thích:</h3>
    <div id="explanation"></div>
</div>

<script>
// ✅ GLOBAL FUNCTION: FAST TRANSLATION
window.translateFast = async function () {
    await runTranslate("rule_based");
};

// ✅ GLOBAL FUNCTION: SMART TRANSLATION
window.translateSmart = async function () {
    await runTranslate("llm_refined");
};

// ✅ CORE FUNCTION USED BY BOTH MODES
async function runTranslate(method) {

    const text = document.getElementById("modern-text").value.trim();
    const errorBox = document.getElementById("error-box");
    const resultBox = document.getElementById("result-box");

    errorBox.style.display = "none";
    resultBox.style.display = "none";

    if (!text) {
        errorBox.textContent = "⚠️ Vui lòng nhập văn bản cần dịch";
        errorBox.style.display = "block";
        return;
    }

    try {
        const response = await fetch("/translate", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ text: text, method: method })
        });

        const data = await response.json();

        if (!data.success) {
            errorBox.textContent = "Lỗi: " + (data.error || "Không rõ nguyên nhân");
            errorBox.style.display = "block";
            return;
        }

        // ✅ Display result
        document.getElementById("translation").textContent = data.translation;
        document.getElementById("explanation").textContent = data.explanation || "—";
        resultBox.style.display = "block";

    } catch (err) {
        errorBox.textContent = "Lỗi kết nối: " + err.message;
        errorBox.style.display = "block";
    }
}

</script>

</body>
</html>
